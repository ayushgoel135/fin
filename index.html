<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbon Eve - Carbon Footprint Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* CSS Variables */
        :root {
            --primary-color: #2E7D32;
            --secondary-color: #81C784;
            --accent-color: #FFC107;
            --dark-color: #1B5E20;
            --light-color: #E8F5E9;
            --text-color: #212121;
            --light-text: #757575;
            --white: #FFFFFF;
            --gray-light: #F5F5F5;
            --gray: #E0E0E0;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-hover: 0 5px 15px rgba(0,0,0,0.1);
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }
        
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            color: var(--text-color);
            background-color: var(--gray-light);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4, h5 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            margin-bottom: 1rem;
            line-height: 1.3;
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        a {
            text-decoration: none;
            color: var(--primary-color);
            transition: var(--transition);
        }
        
        a:hover {
            color: var(--dark-color);
        }
        
        img {
            max-width: 100%;
            height: auto;
        }
        
        /* Container */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        /* Grid System */
        .row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -0.75rem;
        }
        
        .col {
            flex: 1;
            padding: 0 0.75rem;
        }
        
        .col-12 {
            flex: 0 0 100%;
            max-width: 100%;
            padding: 0 0.75rem;
        }
        
        .col-md-6 {
            flex: 0 0 50%;
            max-width: 50%;
            padding: 0 0.75rem;
        }
        
        .col-lg-4 {
            flex: 0 0 33.333333%;
            max-width: 33.333333%;
            padding: 0 0.75rem;
        }
        
        .col-lg-8 {
            flex: 0 0 66.666667%;
            max-width: 66.666667%;
            padding: 0 0.75rem;
        }
        
        /* Utility Classes */
        .text-center {
            text-align: center;
        }
        
        .text-muted {
            color: var(--light-text);
        }
        
        .d-none {
            display: none !important;
        }
        
        .d-flex {
            display: flex;
        }
        
        .d-block {
            display: block;
        }
        
        .justify-content-between {
            justify-content: space-between;
        }
        
        .align-items-center {
            align-items: center;
        }
        
        .gap-3 {
            gap: 1rem;
        }
        
        .mt-3 {
            margin-top: 1rem;
        }
        
        .mt-4 {
            margin-top: 1.5rem;
        }
        
        .mt-5 {
            margin-top: 3rem;
        }
        
        .mb-3 {
            margin-bottom: 1rem;
        }
        
        .mb-4 {
            margin-bottom: 1.5rem;
        }
        
        .mb-5 {
            margin-bottom: 3rem;
        }
        
        .w-100 {
            width: 100%;
        }
        
        /* Buttons */
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: var(--white);
        }
        
        .btn-primary:hover {
            background-color: var(--dark-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        .btn-outline-light {
            background-color: transparent;
            border: 1px solid var(--white);
            color: var(--white);
        }
        
        .btn-outline-light:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        /* Navigation */
        .navbar {
            position: sticky;
            top: 0;
            background-color: var(--primary-color);
            padding: 1rem 0;
            box-shadow: var(--shadow);
            z-index: 1000;
        }
        
        .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .navbar-brand {
            font-weight: 700;
            color: var(--white);
            font-size: 1.5rem;
        }
        
        .navbar-nav {
            display: flex;
            list-style: none;
        }
        
        .nav-item {
            margin-left: 1.5rem;
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }
        
        .nav-link:hover {
            color: var(--accent-color);
        }
        
        .navbar-toggler {
            display: none;
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Hero Section */
        .hero {
            background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://picsum.photos/seed/nature1/1600/800.jpg');
            background-size: cover;
            background-position: center;
            color: var(--white);
            padding: 6rem 0;
            position: relative;
        }
        
        .hero-content {
            max-width: 700px;
        }
        
        .display-4 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
        }
        
        .lead {
            font-size: 1.25rem;
            margin-bottom: 2rem;
        }
        
        /* Cards */
        .card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            overflow: hidden;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 1.5rem;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 1.25rem;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        /* Feature Cards */
        .feature-card {
            height: 100%;
        }
        
        .feature-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        /* Tracker Cards */
        .tracker-card {
            margin-bottom: 1.5rem;
        }
        
        .category-item {
            border-left: 3px solid var(--secondary-color);
            padding-left: 0.75rem;
            margin-bottom: 1.25rem;
            transition: var(--transition);
        }
        
        .category-item:hover {
            border-left-color: var(--primary-color);
        }
        
        /* Progress Bar */
        .progress {
            height: 10px;
            border-radius: 5px;
            background-color: var(--gray);
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 0.35em 0.65em;
            font-size: 0.75em;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 0.375rem;
        }
        
        .badge-success {
            background-color: #198754;
            color: var(--white);
        }
        
        .badge-primary {
            background-color: #0d6efd;
            color: var(--white);
        }
        
        .badge-warning {
            background-color: #ffc107;
            color: var(--text-color);
        }
        
        .badge-danger {
            background-color: #dc3545;
            color: var(--white);
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-control {
            display: block;
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            line-height: 1.5;
            color: var(--text-color);
            background-color: var(--white);
            border: 1px solid var(--gray);
            border-radius: var(--border-radius);
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            outline: 0;
            box-shadow: 0 0 0 3px rgba(46,125,50,0.25);
        }
        
        .form-select {
            display: block;
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            line-height: 1.5;
            color: var(--text-color);
            background-color: var(--white);
            border: 1px solid var(--gray);
            border-radius: var(--border-radius);
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        
        /* Tabs */
        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            border-bottom: 1px solid var(--gray);
            margin-bottom: 1rem;
        }
        
        .nav-tab {
            padding: 0.75rem 1rem;
            border: 1px solid transparent;
            border-top-left-radius: var(--border-radius);
            border-top-right-radius: var(--border-radius);
            background: none;
            cursor: pointer;
            transition: var(--transition);
            color: var(--light-text);
            font-weight: 500;
        }
        
        .nav-tab.active {
            color: var(--primary-color);
            background-color: var(--white);
            border-color: var(--gray) var(--gray) var(--white);
        }
        
        .tab-content {
            width: 100%;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        /* Eco Tips */
        .eco-tip {
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            padding: 1.25rem;
            margin-bottom: 1.25rem;
            border-left: 4px solid var(--primary-color);
        }
        
        .eco-tip-title {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }
        
        .eco-tip-text {
            color: var(--light-text);
            margin-bottom: 0;
        }
        
        /* Footer */
        .footer {
            background-color: var(--dark-color);
            color: var(--white);
            padding: 3rem 0 1.5rem;
        }
        
        .footer-title {
            font-weight: 600;
            margin-bottom: 1.25rem;
            color: var(--white);
        }
        
        .footer-link {
            color: rgba(255,255,255,0.7);
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .footer-link:hover {
            color: var(--accent-color);
            transform: translateX(5px);
        }
        
        .social-icon {
            font-size: 1.5rem;
            color: rgba(255,255,255,0.7);
            margin-right: 0.75rem;
            transition: var(--transition);
        }
        
        .social-icon:hover {
            color: var(--accent-color);
            transform: translateY(-3px);
        }
        
        /* Floating Action Button */
        .btn-floating {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            background-color: var(--accent-color);
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: var(--shadow-hover);
            transition: var(--transition);
            z-index: 1000;
        }
        
        .btn-floating:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }
        
        /* Toast */
        .toast-container {
            position: fixed;
            top: 1.25rem;
            right: 1.25rem;
            z-index: 1100;
        }
        
        .toast {
            background-color: var(--white);
            color: var(--text-color);
            border-left: 4px solid var(--primary-color);
            box-shadow: var(--shadow-hover);
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 250px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .toast-body {
            flex: 1;
        }
        
        .toast-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            color: var(--light-text);
        }
        
        /* Dashboard Specific Styles */
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .stat-label {
            color: var(--light-text);
            font-size: 0.9rem;
        }
        
        .timeline-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 1.5rem;
        }
        
        .timeline-btn {
            padding: 0.5rem 1rem;
            border: none;
            background-color: transparent;
            color: var(--light-text);
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .timeline-btn.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
        }
        
        .history-item {
            border-left: 3px solid var(--secondary-color);
            padding: 0.5rem 0.75rem;
            margin-bottom: 0.75rem;
            transition: var(--transition);
        }
        
        .history-item:hover {
            border-left-color: var(--primary-color);
            background-color: rgba(129, 199, 132, 0.1);
        }
        
        .history-date {
            font-weight: 500;
            color: var(--primary-color);
        }
        
        .history-value {
            font-weight: 600;
        }
        
        /* Leaderboard Styles */
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            transition: var(--transition);
            width: 100%;
        }
        
        .leaderboard-item:last-child {
            border-bottom: none;
        }
        
        .leaderboard-item:hover {
            background-color: rgba(129, 199, 132, 0.1);
        }
        
        .leaderboard-rank {
            width: 1.875rem;
            height: 1.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--light-color);
            border-radius: 50%;
            margin-right: 0.75rem;
            font-weight: 600;
        }
        
        .leaderboard-rank.top-1 {
            background-color: #FFD700;
            color: var(--dark-color);
        }
        
        .leaderboard-rank.top-2 {
            background-color: #C0C0C0;
            color: var(--dark-color);
        }
        
        .leaderboard-rank.top-3 {
            background-color: #CD7F32;
            color: var(--dark-color);
        }
        
        .leaderboard-user {
            flex: 1;
        }
        
        .leaderboard-value {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .leaderboard-you {
            background-color: rgba(46, 125, 50, 0.1);
            border-left: 3px solid var(--primary-color);
        }
        
        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1100;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: var(--white);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-hover);
            transform: translateY(-50px);
            transition: var(--transition);
        }
        
        .modal.show .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 1.25rem;
            border-bottom: 1px solid var(--gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            margin-bottom: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--light-text);
        }
        
        .modal-body {
            padding: 1.25rem;
        }
        
        .modal-footer {
            padding: 1.25rem;
            border-top: 1px solid var(--gray);
            text-align: right;
        }
        
        /* Alert */
        .alert {
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }
        
        .alert-info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        /* Responsive Styles */
        @media (max-width: 992px) {
            .col-lg-4,
            .col-lg-8 {
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .display-4 {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 768px) {
            .col-md-6 {
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .navbar-nav {
                position: fixed;
                top: 0;
                right: -100%;
                height: 100vh;
                width: 70%;
                max-width: 300px;
                background-color: var(--primary-color);
                flex-direction: column;
                padding: 2rem;
                transition: var(--transition);
                z-index: 1001;
            }
            
            .navbar-nav.open {
                right: 0;
            }
            
            .nav-item {
                margin: 0.75rem 0;
            }
            
            .navbar-toggler {
                display: block;
                z-index: 1002;
            }
            
            .hero {
                padding: 4rem 0;
            }
            
            .hero-content {
                text-align: center;
            }
            
            .btn-floating {
                bottom: 1rem;
                right: 1rem;
                width: 3rem;
                height: 3rem;
                font-size: 1rem;
            }
            
            .timeline-selector {
                flex-wrap: wrap;
            }
            
            .timeline-btn {
                margin-bottom: 0.5rem;
            }
        }
        
        @media (max-width: 576px) {
            .container {
                padding: 0 0.5rem;
            }
            
            .row {
                margin: 0 -0.5rem;
            }
            
            .col {
                padding: 0 0.5rem;
            }
            
            .modal-content {
                width: 95%;
            }
        }
        
        /* Hide meat input when vegan/vegetarian is selected */
        #meatContainer {
            transition: var(--transition);
        }
        
        #meatContainer.hidden {
            opacity: 0;
            height: 0;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container navbar-container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-leaf"></i> Carbon Eve
            </a>
            
            <button class="navbar-toggler" id="navbarToggler">
                <i class="fas fa-bars"></i>
            </button>
            
            <ul class="navbar-nav" id="navbarNav">
                <li class="nav-item">
                    <a class="nav-link" href="#home">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#dashboard">Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#tracker">Carbon Tracker</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#leaderboard">Leaderboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#tips">Eco Tips</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#about">About</a>
                </li>
            </ul>
            
            <div id="authButtons">
                <button class="btn btn-outline-light" id="loginBtn">Login</button>
                <button class="btn btn-primary" id="signupBtn">Sign Up</button>
            </div>
            
            <div id="userSection" class="d-none">
                <div class="dropdown">
                    <button class="btn btn-outline-light" id="userDropdown">
                        <i class="fas fa-user-circle"></i>
                        <span id="usernameDisplay">User</span>
                    </button>
                    <div class="dropdown-menu" id="dropdownMenu">
                        <a class="dropdown-item" href="#dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                        <a class="dropdown-item" href="#tracker"><i class="fas fa-calculator"></i> Carbon Tracker</a>
                        <a class="dropdown-item" href="#leaderboard"><i class="fas fa-trophy"></i> Leaderboard</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container">
            <div class="hero-content">
                <h1 class="display-4">Track Your Carbon Footprint</h1>
                <p class="lead">Join the movement to reduce your environmental impact. Our carbon footprint tracker helps you understand and minimize your carbon emissions through simple, actionable insights.</p>
                <div class="d-flex flex-wrap gap-3">
                    <a href="#tracker" class="btn btn-primary">Start Tracking</a>
                    <a href="#leaderboard" class="btn btn-outline-light">View Leaderboard</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section class="py-5" id="dashboard">
        <div class="container">
            <div class="text-center mb-5">
                <h2>Your Carbon Dashboard</h2>
                <p class="text-muted">Track your carbon footprint over time and see your progress.</p>
            </div>
            
            <div class="alert alert-info d-none" id="dashboardLoginAlert">
                Please <a href="#" id="dashboardLoginLink">login</a> to view your personalized dashboard.
            </div>
            
            <div id="dashboardContent" class="d-none">
                <div class="timeline-selector mb-4">
                    <button class="timeline-btn active" data-period="daily">Daily</button>
                    <button class="timeline-btn" data-period="weekly">Weekly</button>
                    <button class="timeline-btn" data-period="monthly">Monthly</button>
                    <button class="timeline-btn" data-period="yearly">Yearly</button>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-fire"></i> Current Footprint</h5>
                            </div>
                            <div class="card-body text-center">
                                <div class="stat-number" id="currentFootprint">0</div>
                                <div class="stat-label">kg CO₂e</div>
                                <div class="mt-3">
                                    <span class="badge bg-success" id="currentComparison">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-line"></i> Trend</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" id="trendChartContainer">
                                    <!-- Chart will be inserted here -->
                                    <div style="height: 300px; display: flex; align-items: center; justify-content: center; background-color: #f8f9fa; border-radius: 8px;">
                                        <p class="text-muted">Chart will appear here when data is available</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-trophy"></i> Achievements</h5>
                            </div>
                            <div class="card-body">
                                <div class="eco-tip mb-3">
                                    <div class="eco-tip-title">
                                        <i class="fas fa-medal"></i> Current Level
                                    </div>
                                    <p class="eco-tip-text">You're a <strong>Beginner Eco Warrior</strong></p>
                                    <div class="progress mt-2">
                                        <div class="progress-bar" role="progressbar" style="width: 25%"></div>
                                    </div>
                                    <small class="text-muted">25% to next level</small>
                                </div>
                                <div class="eco-tip">
                                    <div class="eco-tip-title">
                                        <i class="fas fa-star"></i> Recent Achievement
                                    </div>
                                    <p class="eco-tip-text">You reduced your footprint by 10% this week!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-history"></i> Recent History</h5>
                            </div>
                            <div class="card-body">
                                <div id="historyList">
                                    <div class="alert alert-info">No history available yet. Start tracking your carbon footprint to see your history here.</div>
                                </div>
                                <div class="text-center mt-3">
                                    <a href="#tracker" class="text-primary">Start Tracking</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-pie"></i> Breakdown</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" id="breakdownChartContainer">
                                    <!-- Chart will be inserted here -->
                                    <div style="height: 300px; display: flex; align-items: center; justify-content: center; background-color: #f8f9fa; border-radius: 8px;">
                                        <p class="text-muted">Chart will appear here when data is available</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Improvement Chart Section -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-line"></i> Your Carbon Footprint Improvement</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" id="improvementChartContainer">
                                    <!-- Chart will be inserted here -->
                                    <div style="height: 400px; display: flex; align-items: center; justify-content: center; background-color: #f8f9fa; border-radius: 8px;">
                                        <p class="text-muted">Chart will appear here when data is available</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Carbon Tracker Section -->
    <section class="py-5 bg-light" id="tracker">
        <div class="container">
            <div class="text-center mb-5">
                <h2>Carbon Footprint Tracker</h2>
                <p class="text-muted">Enter your daily activities to calculate your carbon footprint.</p>
            </div>
            
            <div class="alert alert-info d-none" id="trackerLoginAlert">
                Please <a href="#" id="trackerLoginLink">login</a> to save your carbon footprint calculations.
            </div>
            
            <div class="row">
                <div class="col-lg-8 mb-4">
                    <div class="card tracker-card">
                        <div class="card-header">
                            <h4><i class="fas fa-calculator"></i> Calculate Your Carbon Footprint</h4>
                        </div>
                        <div class="card-body">
                            <div class="nav-tabs" id="trackerTabs">
                                <button class="nav-tab active" data-target="transport">Transport</button>
                                <button class="nav-tab" data-target="energy">Energy</button>
                                <button class="nav-tab" data-target="food">Food</button>
                                <button class="nav-tab" data-target="shopping">Shopping</button>
                            </div>
                            
                            <div class="tab-content">
                                <div class="tab-pane active" id="transport">
                                    <form id="transportForm">
                                        <div class="form-group">
                                            <label for="carDistance" class="form-label">Car Distance (km)</label>
                                            <input type="number" class="form-control" id="carDistance" placeholder="Enter distance traveled">
                                        </div>
                                        <div class="form-group">
                                            <label for="carType" class="form-label">Car Type</label>
                                            <select class="form-select" id="carType">
                                                <option value="petrol">Petrol</option>
                                                <option value="diesel">Diesel</option>
                                                <option value="hybrid">Hybrid</option>
                                                <option value="electric">Electric</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="publicTransport" class="form-label">Public Transport (hours)</label>
                                            <input type="number" class="form-control" id="publicTransport" placeholder="Enter hours spent">
                                        </div>
                                        <div class="form-group">
                                            <label for="flights" class="form-label">Flights (number of short-haul flights)</label>
                                            <input type="number" class="form-control" id="flights" placeholder="Enter number of flights">
                                        </div>
                                        <button type="button" class="btn btn-primary" id="calculateTransport">Calculate Transport Impact</button>
                                    </form>
                                </div>
                                
                                <div class="tab-pane" id="energy">
                                    <form id="energyForm">
                                        <div class="form-group">
                                            <label for="electricity" class="form-label">Electricity Usage (kWh)</label>
                                            <input type="number" class="form-control" id="electricity" placeholder="Enter electricity usage">
                                        </div>
                                        <div class="form-group">
                                            <label for="gas" class="form-label">Gas Usage (cubic meters)</label>
                                            <input type="number" class="form-control" id="gas" placeholder="Enter gas usage">
                                        </div>
                                        <button type="button" class="btn btn-primary" id="calculateEnergy">Calculate Energy Impact</button>
                                    </form>
                                </div>
                                
                                <div class="tab-pane" id="food">
                                    <form id="foodForm">
                                        <div class="form-group">
                                            <label for="dietType" class="form-label">How would you describe your diet?</label>
                                            <select class="form-select" id="dietType">
                                                <option value="meat-heavy">Meat-heavy (daily meat)</option>
                                                <option value="balanced" selected>Balanced (meat 3-4 times/week)</option>
                                                <option value="vegetarian">Vegetarian (no meat)</option>
                                                <option value="vegan">Vegan (no animal products)</option>
                                            </select>
                                        </div>
                                        <div id="meatContainer" class="form-group">
                                            <label for="meat" class="form-label">Meat Consumption (kg)</label>
                                            <input type="number" class="form-control" id="meat" placeholder="Enter meat consumption" step="0.1">
                                        </div>
                                        <div class="form-group">
                                            <label for="dairy" class="form-label">Dairy Products (kg)</label>
                                            <input type="number" class="form-control" id="dairy" placeholder="Enter dairy products consumption" step="0.1">
                                        </div>
                                        <div class="form-group">
                                            <label for="processedFood" class="form-label">Processed Food (kg)</label>
                                            <input type="number" class="form-control" id="processedFood" placeholder="Enter processed food consumption" step="0.1">
                                        </div>
                                        <button type="button" class="btn btn-primary" id="calculateFood">Calculate Food Impact</button>
                                    </form>
                                </div>
                                
                                <div class="tab-pane" id="shopping">
                                    <form id="shoppingForm">
                                        <div class="form-group">
                                            <label for="clothing" class="form-label">New Clothing Items (number)</label>
                                            <input type="number" class="form-control" id="clothing" placeholder="Enter number of clothing items">
                                        </div>
                                        <div class="form-group">
                                            <label for="electronics" class="form-label">Electronics Purchased (number)</label>
                                            <input type="number" class="form-control" id="electronics" placeholder="Enter number of electronics">
                                        </div>
                                        <div class="form-group">
                                            <label for="otherGoods" class="form-label">Other Goods (€ spent)</label>
                                            <input type="number" class="form-control" id="otherGoods" placeholder="Enter amount spent">
                                        </div>
                                        <button type="button" class="btn btn-primary" id="calculateShopping">Calculate Shopping Impact</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="card tracker-card">
                        <div class="card-header">
                            <h4><i class="fas fa-leaf"></i> Your Carbon Impact</h4>
                        </div>
                        <div class="card-body">
                            <div class="text-center mb-4">
                                <div class="stat-number" id="totalFootprint">0</div>
                                <p class="text-muted">kg CO₂e per day</p>
                            </div>
                            
                            <div class="category-item">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Transport</span>
                                    <span id="transportImpact">0 kg</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar" id="transportProgress" role="progressbar" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div class="category-item">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Energy</span>
                                    <span id="energyImpact">0 kg</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar" id="energyProgress" role="progressbar" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div class="category-item">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Food</span>
                                    <span id="foodImpact">0 kg</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar" id="foodProgress" role="progressbar" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div class="category-item">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Shopping</span>
                                    <span id="shoppingImpact">0 kg</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar" id="shoppingProgress" role="progressbar" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>Comparison with Average</span>
                                    <span class="badge bg-success" id="comparisonBadge">Loading...</span>
                                </div>
                                <div class="chart-container" id="comparisonChartContainer">
                                    <!-- Chart will be inserted here -->
                                    <div style="height: 200px; display: flex; align-items: center; justify-content: center; background-color: #f8f9fa; border-radius: 8px;">
                                        <p class="text-muted">Chart will appear here when data is available</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4 d-none" id="saveFootprintSection">
                                <button class="btn btn-primary w-100" id="saveFootprintBtn">
                                    <i class="fas fa-save"></i> Save Footprint
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Leaderboard Section -->
    <section class="py-5" id="leaderboard">
        <div class="container">
            <div class="text-center mb-5">
                <h2>Carbon Footprint Leaderboard</h2>
                <p class="text-muted">See how you compare with other eco-conscious users.</p>
            </div>
            
            <div class="alert alert-info d-none" id="leaderboardLoginAlert">
                Please <a href="#" id="leaderboardLoginLink">login</a> to view the leaderboard and see your position.
            </div>
            
            <div id="leaderboardContent" class="d-none">
                <div class="row">
                    <div class="col-lg-8 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h4><i class="fas fa-trophy"></i> Top Eco Warriors</h4>
                            </div>
                            <div class="card-body">
                                <div id="leaderboardList">
                                    <div class="alert alert-info">No leaderboard data available yet. Be the first to track your carbon footprint!</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <h4><i class="fas fa-user"></i> Your Position</h4>
                            </div>
                            <div class="card-body">
                                <div id="userPosition">
                                    <div class="alert alert-info">Save your first footprint to see your position on the leaderboard!</div>
                                </div>
                                <div class="chart-container mt-4" id="leaderboardComparisonChartContainer">
                                    <!-- Chart will be inserted here -->
                                    <div style="height: 200px; display: flex; align-items: center; justify-content: center; background-color: #f8f9fa; border-radius: 8px;">
                                        <p class="text-muted">Chart will appear here when data is available</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Eco Tips Section -->
    <section class="py-5 bg-light" id="tips">
        <div class="container">
            <div class="text-center mb-5">
                <h2>Eco Tips & Suggestions</h2>
                <p class="text-muted">Simple changes can make a big difference to your carbon footprint.</p>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="eco-tip">
                        <div class="eco-tip-title">
                            <i class="fas fa-utensils"></i> Reduce Meat Consumption
                        </div>
                        <p class="eco-tip-text">Meat production, especially beef, has a high carbon footprint. Try incorporating more plant-based meals into your diet to reduce your impact.</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="eco-tip">
                        <div class="eco-tip-title">
                            <i class="fas fa-bus"></i> Use Public Transport
                        </div>
                        <p class="eco-tip-text">Public transportation produces fewer emissions per passenger than individual cars. Consider taking the bus, train, or subway for your daily commute.</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="eco-tip">
                        <div class="eco-tip-title">
                            <i class="fas fa-bolt"></i> Save Energy at Home
                        </div>
                        <p class="eco-tip-text">Turn off lights when not in use, unplug electronics when they're not needed, and use energy-efficient appliances to reduce your home's energy consumption.</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="eco-tip">
                        <div class="eco-tip-title">
                            <i class="fas fa-shopping-bag"></i> Buy Secondhand
                        </div>
                        <p class="eco-tip-text">Shopping secondhand reduces the demand for new products and decreases the resources needed for manufacturing. Consider thrift stores or online marketplaces for your next purchase.</p>
                    </div>
                </div>
            </div>
            
            <div class="mt-5">
                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-lightbulb"></i> Personalized Eco Tips</h4>
                    </div>
                    <div class="card-body">
                        <p>Based on your carbon footprint, here are some personalized recommendations:</p>
                        <div id="personalizedTips">
                            <div class="alert alert-info">
                                Calculate your carbon footprint to receive personalized tips!
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="py-5" id="about">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6 mb-4 mb-md-0">
                    <img src="https://picsum.photos/seed/nature2/600/400.jpg" alt="Eco-friendly community" class="img-fluid rounded shadow">
                </div>
                <div class="col-md-6">
                    <h2 class="mb-4">About Carbon Eve</h2>
                    <p class="mb-4">Carbon Eve is a carbon footprint tracking platform designed to help individuals understand and reduce their environmental impact. Our mission is to empower people with the knowledge and tools they need to make sustainable choices in their daily lives.</p>
                    <p class="mb-4">Our team of environmental scientists and developers have created a comprehensive system that calculates carbon emissions across various aspects of your lifestyle, from transportation and energy use to food consumption and shopping habits.</p>
                    <div class="d-flex gap-3">
                        <button class="btn btn-primary" id="aboutModalBtn">Learn More</button>
                        <button class="btn btn-outline-secondary">Contact Us</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4 mb-md-0">
                    <h5 class="footer-title">Carbon Eve</h5>
                    <p>Helping you track and reduce your carbon footprint for a healthier planet.</p>
                    <div class="mt-4">
                        <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="col-md-2 col-6 mb-4 mb-md-0">
                    <h5 class="footer-title">Links</h5>
                    <a href="#home" class="footer-link">Home</a>
                    <a href="#dashboard" class="footer-link">Dashboard</a>
                    <a href="#tracker" class="footer-link">Carbon Tracker</a>
                    <a href="#leaderboard" class="footer-link">Leaderboard</a>
                    <a href="#tips" class="footer-link">Eco Tips</a>
                    <a href="#about" class="footer-link">About</a>
                </div>
                <div class="col-md-2 col-6 mb-4 mb-md-0">
                    <h5 class="footer-title">Resources</h5>
                    <a href="#" class="footer-link">Blog</a>
                    <a href="#" class="footer-link">Research</a>
                    <a href="#" class="footer-link">Guides</a>
                    <a href="#" class="footer-link">FAQ</a>
                    <a href="#" class="footer-link">Support</a>
                </div>
                <div class="col-md-4">
                    <h5 class="footer-title">Newsletter</h5>
                    <p>Subscribe to our newsletter for the latest eco tips and updates.</p>
                    <form class="mt-3" id="newsletterForm">
                        <div class="d-flex">
                            <input type="email" class="form-control" placeholder="Your email" aria-label="Your email">
                            <button class="btn btn-primary" type="submit">Subscribe</button>
                        </div>
                    </form>
                </div>
            </div>
            <hr class="my-4">
            <div class="text-center">
                <p>&copy; 2023 Carbon Eve. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Floating Action Button -->
    <a href="#tracker" class="btn-floating">
        <i class="fas fa-calculator"></i>
    </a>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Sign Up Modal -->
    <div class="modal" id="signupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Sign Up for Carbon Eve</h5>
                <button type="button" class="modal-close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="signupForm">
                    <div class="form-group">
                        <label for="fullName" class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="fullName" placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="email" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" placeholder="Create a password">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword" class="form-label">Confirm Password</label>
                        <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm your password">
                    </div>
                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="termsCheck">
                            <label class="form-check-label" for="termsCheck">I agree to the Terms and Conditions</label>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary w-100" id="signupButton">Sign Up</button>
                </form>
                <p class="text-center mt-3">Already have an account? <a href="#" id="loginFromSignupLink">Log In</a></p>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Log In to Carbon Eve</h5>
                <button type="button" class="modal-close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password">
                    </div>
                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="rememberCheck">
                            <label class="form-check-label" for="rememberCheck">Remember me</label>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary w-100" id="loginButton">Log In</button>
                </form>
                <p class="text-center mt-3">Don't have an account? <a href="#" id="signupFromLoginLink">Sign Up</a></p>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div class="modal" id="aboutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">About Carbon Eve</h5>
                <button type="button" class="modal-close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6 mb-4 mb-md-0">
                        <img src="https://picsum.photos/seed/nature3/400/300.jpg" alt="Carbon Eve Team" class="img-fluid rounded">
                    </div>
                    <div class="col-md-6">
                        <h4>Our Mission</h4>
                        <p>Carbon Eve was founded with a simple mission: to empower individuals to make sustainable choices by understanding their environmental impact.</p>
                        <p>Our platform combines scientific research with user-friendly technology to provide accurate carbon footprint calculations and actionable recommendations.</p>
                    </div>
                </div>
                <div class="mt-4">
                    <h4>Our Team</h4>
                    <p>Our team consists of software developers who are passionate about creating a more eco-conscious world.</p>
                    <div class="row mt-3">
                        <div class="col-md-3 text-center mb-3">
                            <h6>Jaskirat Kaur</h6>
                            <p class="text-muted small">Full stack Developer</p>
                        </div>
                        <div class="col-md-3 text-center mb-3">
                            <h6>Shivam Mishra</h6>
                            <p class="text-muted small">Frontend Developer</p>
                        </div>
                        <div class="col-md-3 text-center mb-3">
                            <h6>Mayank Sharma</h6>
                            <p class="text-muted small">UI/UX Designer</p>
                        </div>
                        <div class="col-md-3 text-center mb-3">
                            <h6>Ayush Goel</h6>
                            <p class="text-muted small">Team Leader/Backend Developer</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Custom JavaScript implementation without external libraries
        
        // DOM Ready Function
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the application
            initApp();
        });
        
        function initApp() {
            // Initialize database
            CarbonEveDB.init();
            
            // Setup event listeners
            setupEventListeners();
            
            // Check if user is logged in
            const currentUser = CarbonEveDB.getCurrentUser();
            if (currentUser) {
                updateUIForLoggedInUser(currentUser);
            }
            
            // Setup navigation
            setupNavigation();
            
            // Setup modals
            setupModals();
        }
        
        function setupEventListeners() {
            // Navigation toggler
            document.getElementById('navbarToggler').addEventListener('click', toggleNavigation);
            
            // Login and signup buttons
            document.getElementById('loginBtn').addEventListener('click', function() {
                showModal('loginModal');
            });
            
            document.getElementById('signupBtn').addEventListener('click', function() {
                showModal('signupModal');
            });
            
            // Auth form links
            document.getElementById('loginFromSignupLink').addEventListener('click', function(e) {
                e.preventDefault();
                hideModal('signupModal');
                showModal('loginModal');
            });
            
            document.getElementById('signupFromLoginLink').addEventListener('click', function(e) {
                e.preventDefault();
                hideModal('loginModal');
                showModal('signupModal');
            });
            
            // Login and signup form submissions
            document.getElementById('signupButton').addEventListener('click', handleSignup);
            document.getElementById('loginButton').addEventListener('click', handleLogin);
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // About modal button
            document.getElementById('aboutModalBtn').addEventListener('click', function() {
                showModal('aboutModal');
            });
            
            // Tracker calculation buttons
            document.getElementById('calculateTransport').addEventListener('click', function() {
                calculateImpact('transport');
            });
            
            document.getElementById('calculateEnergy').addEventListener('click', function() {
                calculateImpact('energy');
            });
            
            document.getElementById('calculateFood').addEventListener('click', function() {
                calculateImpact('food');
            });
            
            document.getElementById('calculateShopping').addEventListener('click', function() {
                calculateImpact('shopping');
            });
            
            // Save footprint button
            document.getElementById('saveFootprintBtn').addEventListener('click', saveFootprint);
            
            // Diet type change
            document.getElementById('dietType').addEventListener('change', toggleMeatInput);
            
            // Tracker tabs
            const tabButtons = document.querySelectorAll('.nav-tab');
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const target = this.getAttribute('data-target');
                    switchTab(target);
                });
            });
            
            // Timeline buttons
            const timelineButtons = document.querySelectorAll('.timeline-btn');
            timelineButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const period = this.getAttribute('data-period');
                    updateDashboardCharts(period);
                    
                    // Update active state
                    timelineButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Login links in alerts
            document.getElementById('dashboardLoginLink').addEventListener('click', function(e) {
                e.preventDefault();
                showModal('loginModal');
            });
            
            document.getElementById('trackerLoginLink').addEventListener('click', function(e) {
                e.preventDefault();
                showModal('loginModal');
            });
            
            document.getElementById('leaderboardLoginLink').addEventListener('click', function(e) {
                e.preventDefault();
                showModal('loginModal');
            });
            
            // Newsletter form
            document.getElementById('newsletterForm').addEventListener('submit', function(e) {
                e.preventDefault();
                showToast('Thank you for subscribing to our newsletter!', 'success');
                this.reset();
            });
            
            // Smooth scrolling for anchor links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetId = this.getAttribute('href');
                    if (targetId === '#') return;
                    
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        // Close mobile navigation if open
                        document.getElementById('navbarNav').classList.remove('open');
                        
                        window.scrollTo({
                            top: targetElement.offsetTop - 70,
                            behavior: 'smooth'
                        });
                        
                        // Special handling for leaderboard
                        if (targetId === '#leaderboard') {
                            const currentUser = CarbonEveDB.getCurrentUser();
                            if (!currentUser) {
                                document.getElementById('leaderboardLoginAlert').classList.remove('d-none');
                                document.getElementById('leaderboardContent').classList.add('d-none');
                            } else {
                                document.getElementById('leaderboardLoginAlert').classList.add('d-none');
                                document.getElementById('leaderboardContent').classList.remove('d-none');
                                updateLeaderboard();
                            }
                        }
                    }
                });
            });
        }
        
        function setupNavigation() {
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                const dropdown = document.getElementById('dropdownMenu');
                const userDropdown = document.getElementById('userDropdown');
                
                if (dropdown && dropdown.classList.contains('show') && !e.target.closest('.dropdown')) {
                    dropdown.classList.remove('show');
                }
                
                if (e.target === userDropdown) {
                    dropdown.classList.toggle('show');
                }
            });
        }
        
        function setupModals() {
            // Close modals when clicking on close button or outside
            document.querySelectorAll('.modal-close, [data-dismiss="modal"]').forEach(button => {
                button.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    hideModal(modal.id);
                });
            });
            
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        hideModal(this.id);
                    }
                });
            });
        }
        
        function toggleNavigation() {
            document.getElementById('navbarNav').classList.toggle('open');
        }
        
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }
        
        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }
        
        function switchTab(targetId) {
            // Hide all tab panes
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            
            // Show the selected tab pane
            document.getElementById(targetId).classList.add('active');
            
            // Update active tab button
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelector(`[data-target="${targetId}"]`).classList.add('active');
        }
        
        function toggleMeatInput() {
            const dietType = document.getElementById('dietType').value;
            const meatContainer = document.getElementById('meatContainer');
            
            if (dietType === 'vegan' || dietType === 'vegetarian') {
                meatContainer.classList.add('hidden');
                document.getElementById('meat').value = '0';
            } else {
                meatContainer.classList.remove('hidden');
            }
        }
        
        function handleSignup() {
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const termsCheck = document.getElementById('termsCheck').checked;
            
            if (!fullName || !email || !password || !confirmPassword) {
                showToast('Please fill in all fields', 'danger');
                return;
            }
            
            if (password !== confirmPassword) {
                showToast('Passwords do not match', 'danger');
                return;
            }
            
            if (!termsCheck) {
                showToast('Please agree to the Terms and Conditions', 'danger');
                return;
            }
            
            // Create new user
            const newUser = {
                name: fullName,
                email: email,
                password: password
            };
            
            const createdUser = CarbonEveDB.addUser(newUser);
            
            if (createdUser) {
                CarbonEveDB.setCurrentUser(createdUser);
                
                showToast('Account created successfully!', 'success');
                updateUIForLoggedInUser(createdUser);
                
                // Close modal after delay
                setTimeout(() => {
                    hideModal('signupModal');
                }, 1500);
            } else {
                showToast('User with this email already exists', 'danger');
            }
        }
        
        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showToast('Please enter both email and password', 'danger');
                return;
            }
            
            const user = CarbonEveDB.getUserByEmail(email);
            
            if (!user || user.password !== password) {
                showToast('Invalid email or password', 'danger');
                return;
            }
            
            CarbonEveDB.setCurrentUser(user);
            
            showToast('Login successful!', 'success');
            updateUIForLoggedInUser(user);
            
            // Close modal after delay
            setTimeout(() => {
                hideModal('loginModal');
            }, 1500);
        }
        
        function handleLogout(e) {
            e.preventDefault();
            CarbonEveDB.logout();
            showToast('Logged out successfully', 'success');
            updateUIForLoggedOutUser();
        }
        
        function updateUIForLoggedInUser(user) {
            document.getElementById('authButtons').classList.add('d-none');
            document.getElementById('userSection').classList.remove('d-none');
            document.getElementById('usernameDisplay').textContent = user.name.split(' ')[0];
            document.getElementById('saveFootprintSection').classList.remove('d-none');
            document.getElementById('dashboardLoginAlert').classList.add('d-none');
            document.getElementById('dashboardContent').classList.remove('d-none');
            document.getElementById('trackerLoginAlert').classList.add('d-none');
            document.getElementById('leaderboardLoginAlert').classList.add('d-none');
            document.getElementById('leaderboardContent').classList.remove('d-none');
            
            // Update dashboard with daily view by default
            updateDashboardCharts('daily');
            
            // Update leaderboard
            updateLeaderboard();
        }
        
        function updateUIForLoggedOutUser() {
            document.getElementById('authButtons').classList.remove('d-none');
            document.getElementById('userSection').classList.add('d-none');
            document.getElementById('saveFootprintSection').classList.add('d-none');
            document.getElementById('dashboardLoginAlert').classList.remove('d-none');
            document.getElementById('dashboardContent').classList.add('d-none');
            document.getElementById('trackerLoginAlert').classList.remove('d-none');
            document.getElementById('leaderboardLoginAlert').classList.remove('d-none');
            document.getElementById('leaderboardContent').classList.add('d-none');
        }
        
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            toast.innerHTML = `
                <div class="toast-body">${message}</div>
                <button type="button" class="toast-close">&times;</button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Add event listener to close button
            toast.querySelector('.toast-close').addEventListener('click', function() {
                toast.remove();
            });
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 5000);
        }
        
        function calculateImpact(category) {
            let impact = 0;
            
            switch(category) {
                case 'transport':
                    const carDistance = parseFloat(document.getElementById('carDistance').value) || 0;
                    const carType = document.getElementById('carType').value;
                    const publicTransport = parseFloat(document.getElementById('publicTransport').value) || 0;
                    const flights = parseFloat(document.getElementById('flights').value) || 0;
                    
                    // Simple calculation (these are just example values)
                    let carFactor = 0;
                    switch(carType) {
                        case 'petrol': carFactor = 0.2; break;
                        case 'diesel': carFactor = 0.18; break;
                        case 'hybrid': carFactor = 0.1; break;
                        case 'electric': carFactor = 0.05; break;
                    }
                    
                    impact = (carDistance * carFactor) + (publicTransport * 0.1) + (flights * 50);
                    document.getElementById('transportImpact').textContent = impact.toFixed(1) + ' kg';
                    document.getElementById('transportProgress').style.width = (impact / 10 * 100) + '%';
                    break;
                    
                case 'energy':
                    const electricity = parseFloat(document.getElementById('electricity').value) || 0;
                    const gas = parseFloat(document.getElementById('gas').value) || 0;
                    
                    impact = (electricity * 0.5) + (gas * 2);
                    document.getElementById('energyImpact').textContent = impact.toFixed(1) + ' kg';
                    document.getElementById('energyProgress').style.width = (impact / 10 * 100) + '%';
                    break;
                    
                case 'food':
                    const dietType = document.getElementById('dietType').value;
                    const meat = parseFloat(document.getElementById('meat').value) || 0;
                    const dairy = parseFloat(document.getElementById('dairy').value) || 0;
                    const processedFood = parseFloat(document.getElementById('processedFood').value) || 0;
                    
                    // Base impact calculations (kg CO2 per kg of food)
                    const meatImpact = meat * 27; // Beef has ~27kg CO2/kg
                    const dairyImpact = dairy * 3; // Dairy has ~3kg CO2/kg
                    const processedFoodImpact = processedFood * 2; // Processed food ~2kg CO2/kg
                    
                    // Apply diet type modifiers
                    let dietModifier = 1;
                    switch(dietType) {
                        case 'meat-heavy':
                            dietModifier = 1.2; // 20% higher impact for meat-heavy diets
                            break;
                        case 'balanced':
                            dietModifier = 1.0; // No modifier for balanced diet
                            break;
                        case 'vegetarian':
                            dietModifier = 0.7; // 30% lower impact for vegetarians
                            break;
                        case 'vegan':
                            dietModifier = 0.5; // 50% lower impact for vegans
                            break;
                    }
                    
                    impact = (meatImpact + dairyImpact + processedFoodImpact) * dietModifier;
                    document.getElementById('foodImpact').textContent = impact.toFixed(1) + ' kg';
                    document.getElementById('foodProgress').style.width = (impact / 10 * 100) + '%';
                    break;
                    
                case 'shopping':
                    const clothing = parseFloat(document.getElementById('clothing').value) || 0;
                    const electronics = parseFloat(document.getElementById('electronics').value) || 0;
                    const otherGoods = parseFloat(document.getElementById('otherGoods').value) || 0;
                    
                    impact = (clothing * 30) + (electronics * 100) + (otherGoods * 0.1);
                    document.getElementById('shoppingImpact').textContent = impact.toFixed(1) + ' kg';
                    document.getElementById('shoppingProgress').style.width = (impact / 10 * 100) + '%';
                    break;
            }
            
            // Update total footprint
            const transportImpact = parseFloat(document.getElementById('transportImpact').textContent) || 0;
            const energyImpact = parseFloat(document.getElementById('energyImpact').textContent) || 0;
            const foodImpact = parseFloat(document.getElementById('foodImpact').textContent) || 0;
            const shoppingImpact = parseFloat(document.getElementById('shoppingImpact').textContent) || 0;
            
            const totalImpact = transportImpact + energyImpact + foodImpact + shoppingImpact;
            document.getElementById('totalFootprint').textContent = totalImpact.toFixed(1);
            
            // Update comparison badge
            const avgImpact = 6; // Average daily carbon footprint in kg
            if (totalImpact < avgImpact * 0.7) {
                document.getElementById('comparisonBadge').textContent = 'Excellent';
                document.getElementById('comparisonBadge').className = 'badge bg-success';
            } else if (totalImpact < avgImpact) {
                document.getElementById('comparisonBadge').textContent = 'Good';
                document.getElementById('comparisonBadge').className = 'badge bg-primary';
            } else if (totalImpact < avgImpact * 1.3) {
                document.getElementById('comparisonBadge').textContent = 'Average';
                document.getElementById('comparisonBadge').className = 'badge bg-warning';
            } else {
                document.getElementById('comparisonBadge').textContent = 'High';
                document.getElementById('comparisonBadge').className = 'badge bg-danger';
            }
            
            // Update personalized tips
            updatePersonalizedTips(totalImpact, {
                transport: transportImpact,
                energy: energyImpact,
                food: foodImpact,
                shopping: shoppingImpact
            }, { dietType: document.getElementById('dietType').value });
            
            showToast('Carbon impact calculated successfully!', 'success');
        }
        
        function updatePersonalizedTips(total, impacts, additionalData = {}) {
            const tipsContainer = document.getElementById('personalizedTips');
            let tipsHTML = '';
            
            if (total === 0) {
                tipsHTML = '<div class="alert alert-info">Calculate your carbon footprint to receive personalized tips!</div>';
            } else {
                // Find the highest impact category
                const categories = Object.keys(impacts);
                let highestCategory = categories[0];
                let highestImpact = impacts[highestCategory];
                
                for (const category of categories) {
                    if (impacts[category] > highestImpact) {
                        highestCategory = category;
                        highestImpact = impacts[category];
                    }
                }
                
                // Generate tips based on highest impact category
                switch(highestCategory) {
                    case 'transport':
                        tipsHTML = `
                            <div class="eco-tip mb-3">
                                <div class="eco-tip-title">
                                    <i class="fas fa-bus me-2"></i>Transport Tips
                                </div>
                                <p class="eco-tip-text">Your transport emissions are the highest. Consider these changes:</p>
                                <ul class="mt-2">
                                    <li>Use public transportation, cycling, or walking for short distances</li>
                                    <li>Consider carpooling with colleagues or neighbors</li>
                                    <li>Switch to a more fuel-efficient vehicle if possible</li>
                                    <li>Reduce air travel or choose direct flights when possible</li>
                                </ul>
                            </div>
                        `;
                        break;
                    case 'energy':
                        tipsHTML = `
                            <div class="eco-tip mb-3">
                                <div class="eco-tip-title">
                                    <i class="fas fa-bolt me-2"></i>Energy Tips
                                </div>
                                <p class="eco-tip-text">Your energy usage has the biggest impact. Try these suggestions:</p>
                                <ul class="mt-2">
                                    <li>Switch to LED lighting throughout your home</li>
                                    <li>Unplug electronics when not in use to avoid phantom energy usage</li>
                                    <li>Use smart thermostats to optimize heating and cooling</li>
                                    <li>Consider renewable energy sources like solar panels if feasible</li>
                                </ul>
                            </div>
                        `;
                        break;
                    case 'food':
                        tipsHTML = `
                            <div class="eco-tip mb-3">
                                <div class="eco-tip-title">
                                    <i class="fas fa-utensils me-2"></i>Food Tips
                                </div>
                                <p class="eco-tip-text">Your food choices have the highest carbon impact. Here are some ideas:</p>
                                <ul class="mt-2">
                                    <li>Try incorporating more plant-based meals into your diet</li>
                                    <li>Buy local and seasonal produce to reduce transportation emissions</li>
                                    <li>Reduce food waste by planning meals and using leftovers</li>
                                    <li>Choose organic and sustainably farmed products when possible</li>
                                </ul>
                            </div>
                        `;
                        break;
                    case 'shopping':
                        tipsHTML = `
                            <div class="eco-tip mb-3">
                                <div class="eco-tip-title">
                                    <i class="fas fa-shopping-bag me-2"></i>Shopping Tips
                                </div>
                                <p class="eco-tip-text">Your consumption habits have the biggest impact. Consider these changes:</p>
                                <ul class="mt-2">
                                    <li>Buy less, but buy better - focus on quality over quantity</li>
                                    <li>Choose secondhand or upcycled items when possible</li>
                                    <li>Support brands with sustainable and ethical practices</li>
                                    <li>Reduce packaging by buying in bulk or choosing minimal packaging options</li>
                                </ul>
                            </div>
                        `;
                        break;
                }
                
                // Add diet-specific tips if available
                if (additionalData.dietType) {
                    switch(additionalData.dietType) {
                        case 'meat-heavy':
                            tipsHTML += `
                                <div class="eco-tip mb-3">
                                    <div class="eco-tip-title">
                                        <i class="fas fa-utensils me-2"></i>Diet Suggestion
                                    </div>
                                    <p class="eco-tip-text">Your diet is meat-heavy, which has a high carbon footprint. Consider reducing meat portions or having meat-free days.</p>
                                </div>
                            `;
                            break;
                        case 'vegetarian':
                            tipsHTML += `
                                <div class="eco-tip mb-3">
                                    <div class="eco-tip-title">
                                        <i class="fas fa-utensils me-2"></i>Diet Suggestion
                                    </div>
                                    <p class="eco-tip-text">Great job with a vegetarian diet! To further reduce impact, consider plant-based dairy alternatives.</p>
                                </div>
                            `;
                            break;
                        case 'vegan':
                            tipsHTML += `
                                <div class="eco-tip mb-3">
                                    <div class="eco-tip-title">
                                        <i class="fas fa-utensils me-2"></i>Diet Suggestion
                                    </div>
                                    <p class="eco-tip-text">Excellent choice with a vegan diet! You're already making a significant positive environmental impact.</p>
                                </div>
                            `;
                            break;
                    }
                }
                
                // Add general tips
                tipsHTML += `
                    <div class="eco-tip">
                        <div class="eco-tip-title">
                            <i class="fas fa-leaf me-2"></i>General Tips
                        </div>
                        <p class="eco-tip-text">Regardless of your highest impact area, these general tips can help reduce your carbon footprint:</p>
                        <ul class="mt-2">
                            <li>Reduce, reuse, and recycle to minimize waste</li>
                            <li>Conserve water - it takes energy to process and deliver water</li>
                            <li>Support policies and initiatives that promote sustainability</li>
                            <li>Share what you've learned with friends and family</li>
                        </ul>
                    </div>
                `;
            }
            
            tipsContainer.innerHTML = tipsHTML;
        }
        
        function saveFootprint() {
            const currentUser = CarbonEveDB.getCurrentUser();
            if (!currentUser) {
                showToast('Please login to save your footprint', 'danger');
                return;
            }
            
            const transportImpact = parseFloat(document.getElementById('transportImpact').textContent) || 0;
            const energyImpact = parseFloat(document.getElementById('energyImpact').textContent) || 0;
            const foodImpact = parseFloat(document.getElementById('foodImpact').textContent) || 0;
            const shoppingImpact = parseFloat(document.getElementById('shoppingImpact').textContent) || 0;
            const totalImpact = transportImpact + energyImpact + foodImpact + shoppingImpact;
            
            if (totalImpact === 0) {
                showToast('Please calculate your footprint before saving', 'warning');
                return;
            }
            
            const footprint = {
                user_id: currentUser.id,
                date: new Date().toISOString(),
                transport: transportImpact,
                energy: energyImpact,
                food: foodImpact,
                shopping: shoppingImpact,
                total: totalImpact
            };
            
            if (CarbonEveDB.saveFootprint(footprint)) {
                showToast('Carbon footprint saved successfully!', 'success');
                
                // Update dashboard if visible
                if (window.location.hash === '#dashboard') {
                    const activePeriod = document.querySelector('.timeline-btn.active').dataset.period;
                    updateDashboardCharts(activePeriod);
                }
                
                // Update leaderboard if visible
                if (window.location.hash === '#leaderboard') {
                    updateLeaderboard();
                }
            } else {
                showToast('Failed to save footprint', 'danger');
            }
        }
        
        function updateDashboardCharts(period) {
            const currentUser = CarbonEveDB.getCurrentUser();
            if (!currentUser) return;
            
            const footprints = CarbonEveDB.getFootprintsByPeriod(currentUser.id, period);
            
            if (footprints.length === 0) {
                document.getElementById('currentFootprint').textContent = '0';
                document.getElementById('currentComparison').textContent = 'No data yet';
                document.getElementById('currentComparison').className = 'badge bg-info';
                return;
            }
            
            // Update current footprint
            const latestFootprint = footprints[footprints.length - 1];
            document.getElementById('currentFootprint').textContent = latestFootprint.total.toFixed(1);
            
            // Update comparison badge
            const avgImpact = 6; // Average daily carbon footprint in kg
            if (latestFootprint.total < avgImpact * 0.7) {
                document.getElementById('currentComparison').textContent = 'Excellent';
                document.getElementById('currentComparison').className = 'badge bg-success';
            } else if (latestFootprint.total < avgImpact) {
                document.getElementById('currentComparison').textContent = 'Good';
                document.getElementById('currentComparison').className = 'badge bg-primary';
            } else if (latestFootprint.total < avgImpact * 1.3) {
                document.getElementById('currentComparison').textContent = 'Average';
                document.getElementById('currentComparison').className = 'badge bg-warning';
            } else {
                document.getElementById('currentComparison').textContent = 'High';
                document.getElementById('currentComparison').className = 'badge bg-danger';
            }
            
            // Update history list
            updateHistoryList();
        }
        
        function updateHistoryList() {
            const currentUser = CarbonEveDB.getCurrentUser();
            if (!currentUser) return;
            
            const footprints = CarbonEveDB.getFootprintsByUser(currentUser.id);
            const historyList = document.getElementById('historyList');
            
            // Clear existing content
            historyList.innerHTML = '';
            
            if (footprints.length === 0) {
                historyList.innerHTML = '<div class="alert alert-info">No history available yet</div>';
                return;
            }
            
            // Show last 5 entries
            footprints.slice(0, 5).forEach(fp => {
                const date = new Date(fp.date);
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="d-flex justify-content-between">
                        <span class="history-date">${date.toLocaleDateString()}</span>
                        <span class="history-value">${fp.total.toFixed(1)} kg CO₂e</span>
                    </div>
                `;
                historyList.appendChild(historyItem);
            });
        }
        
        function updateLeaderboard() {
            const currentUser = CarbonEveDB.getCurrentUser();
            if (!currentUser) return;
            
            const leaderboard = CarbonEveDB.getLatestFootprints();
            const leaderboardList = document.getElementById('leaderboardList');
            const userPosition = document.getElementById('userPosition');
            
            // Clear existing content
            leaderboardList.innerHTML = '';
            userPosition.innerHTML = '';
            
            if (leaderboard.length === 0) {
                leaderboardList.innerHTML = '<div class="alert alert-info">No data available yet</div>';
                userPosition.innerHTML = '<div class="alert alert-info">No data available yet</div>';
                return;
            }
            
            // Find current user's position
            const userFootprint = leaderboard.find(item => item.user_id === currentUser.id);
            const userRank = userFootprint ? leaderboard.indexOf(userFootprint) + 1 : null;
            
            // Display top 10 users
            leaderboard.slice(0, 10).forEach((item, index) => {
                const leaderboardItem = document.createElement('div');
                leaderboardItem.className = `leaderboard-item ${item.user_id === currentUser.id ? 'leaderboard-you' : ''}`;
                
                const rankClass = index < 3 ? `top-${index + 1}` : '';
                
                leaderboardItem.innerHTML = `
                    <div class="leaderboard-rank ${rankClass}">${index + 1}</div>
                    <div class="leaderboard-user">${item.user_name}</div>
                    <div class="leaderboard-value">${item.total.toFixed(1)} kg</div>
                `;
                
                leaderboardList.appendChild(leaderboardItem);
            });
            
            // Display user's position
            if (userFootprint) {
                userPosition.innerHTML = `
                    <div class="leaderboard-item leaderboard-you">
                        <div class="leaderboard-rank ${userRank <= 3 ? `top-${userRank}` : ''}">${userRank}</div>
                        <div class="leaderboard-user">${currentUser.name}</div>
                        <div class="leaderboard-value">${userFootprint.total.toFixed(1)} kg</div>
                    </div>
                    <div class="mt-3">
                        <p>You are in the top <strong>${Math.round((userRank / leaderboard.length) * 100)}%</strong> of users!</p>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: ${100 - ((userRank / leaderboard.length) * 100)}%"></div>
                        </div>
                    </div>
                `;
            } else {
                userPosition.innerHTML = '<div class="alert alert-info">Save your first footprint to appear on the leaderboard!</div>';
            }
        }
        
        // Database operations using localStorage
        const CarbonEveDB = {
            // Initialize the database
            init: function() {
                // Initialize users and footprints if they don't exist
                if (!localStorage.getItem('carbonEveUsers')) {
                    localStorage.setItem('carbonEveUsers', JSON.stringify([]));
                }
                
                if (!localStorage.getItem('carbonEveFootprints')) {
                    localStorage.setItem('carbonEveFootprints', JSON.stringify([]));
                }
                
                return true;
            },
            
            // Get all users
            getUsers: function() {
                return JSON.parse(localStorage.getItem('carbonEveUsers')) || [];
            },
            
            // Get all footprints
            getFootprints: function() {
                return JSON.parse(localStorage.getItem('carbonEveFootprints')) || [];
            },
            
            // Add a new user
            addUser: function(user) {
                const users = this.getUsers();
                
                // Check if user already exists
                if (users.some(u => u.email === user.email)) {
                    return null;
                }
                
                // Assign an ID
                user.id = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;
                users.push(user);
                localStorage.setItem('carbonEveUsers', JSON.stringify(users));
                
                return user;
            },
            
            // Get user by email
            getUserByEmail: function(email) {
                const users = this.getUsers();
                return users.find(user => user.email === email) || null;
            },
            
            // Save a footprint
            saveFootprint: function(footprint) {
                const footprints = this.getFootprints();
                
                // Assign an ID
                footprint.id = footprints.length > 0 ? Math.max(...footprints.map(f => f.id)) + 1 : 1;
                footprints.push(footprint);
                localStorage.setItem('carbonEveFootprints', JSON.stringify(footprints));
                
                return true;
            },
            
            // Get footprints by user ID
            getFootprintsByUser: function(userId) {
                const footprints = this.getFootprints();
                return footprints.filter(fp => fp.user_id === userId)
                                .sort((a, b) => new Date(b.date) - new Date(a.date));
            },
            
            // Get the latest footprint for each user
            getLatestFootprints: function() {
                const footprints = this.getFootprints();
                const users = this.getUsers();
                
                // Group footprints by user and get the latest one for each
                const latestFootprints = [];
                const userMap = {};
                
                // Create a map of users by ID
                users.forEach(user => {
                    userMap[user.id] = user;
                });
                
                // Sort footprints by date (newest first)
                footprints.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Get the latest footprint for each user
                const userFootprints = {};
                footprints.forEach(fp => {
                    if (!userFootprints[fp.user_id] && userMap[fp.user_id]) {
                        userFootprints[fp.user_id] = {
                            ...fp,
                            user_name: userMap[fp.user_id].name
                        };
                    }
                });
                
                // Convert to array and sort by total footprint (lowest first)
                return Object.values(userFootprints)
                    .sort((a, b) => a.total - b.total);
            },
            
            // Get footprints by period for a specific user
            getFootprintsByPeriod: function(userId, period) {
                const footprints = this.getFootprintsByUser(userId);
                
                if (footprints.length === 0) {
                    return [];
                }
                
                switch(period) {
                    case 'daily':
                        // Get last 7 days
                        return footprints.slice(0, 7).reverse();
                        
                    case 'weekly':
                        // Group by week and calculate averages
                        const weeklyData = {};
                        footprints.forEach(fp => {
                            const date = new Date(fp.date);
                            const week = `${date.getFullYear()}-${this.getWeekNumber(date)}`;
                            
                            if (!weeklyData[week]) {
                                weeklyData[week] = {
                                    week: week,
                                    count: 0,
                                    total: 0,
                                    transport: 0,
                                    energy: 0,
                                    food: 0,
                                    shopping: 0
                                };
                            }
                            
                            weeklyData[week].count++;
                            weeklyData[week].total += fp.total;
                            weeklyData[week].transport += fp.transport;
                            weeklyData[week].energy += fp.energy;
                            weeklyData[week].food += fp.food;
                            weeklyData[week].shopping += fp.shopping;
                        });
                        
                        // Calculate averages and format
                        return Object.values(weeklyData)
                            .map(week => ({
                                week: week.week,
                                avg_total: week.total / week.count,
                                avg_transport: week.transport / week.count,
                                avg_energy: week.energy / week.count,
                                avg_food: week.food / week.count,
                                avg_shopping: week.shopping / week.count
                            }))
                            .sort((a, b) => a.week.localeCompare(b.week))
                            .slice(-12); // Last 12 weeks
                            
                    case 'monthly':
                        // Group by month and calculate averages
                        const monthlyData = {};
                        footprints.forEach(fp => {
                            const date = new Date(fp.date);
                            const month = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                            
                            if (!monthlyData[month]) {
                                monthlyData[month] = {
                                    month: month,
                                    count: 0,
                                    total: 0,
                                    transport: 0,
                                    energy: 0,
                                    food: 0,
                                    shopping: 0
                                };
                            }
                            
                            monthlyData[month].count++;
                            monthlyData[month].total += fp.total;
                            monthlyData[month].transport += fp.transport;
                            monthlyData[month].energy += fp.energy;
                            monthlyData[month].food += fp.food;
                            monthlyData[month].shopping += fp.shopping;
                        });
                        
                        // Calculate averages and format
                        return Object.values(monthlyData)
                            .map(month => ({
                                month: month.month,
                                avg_total: month.total / month.count,
                                avg_transport: month.transport / month.count,
                                avg_energy: month.energy / month.count,
                                avg_food: month.food / month.count,
                                avg_shopping: month.shopping / month.count
                            }))
                            .sort((a, b) => a.month.localeCompare(b.week))
                            .slice(-12); // Last 12 months
                            
                    case 'yearly':
                        // Group by year and calculate averages
                        const yearlyData = {};
                        footprints.forEach(fp => {
                            const date = new Date(fp.date);
                            const year = date.getFullYear().toString();
                            
                            if (!yearlyData[year]) {
                                yearlyData[year] = {
                                    year: year,
                                    count: 0,
                                    total: 0,
                                    transport: 0,
                                    energy: 0,
                                    food: 0,
                                    shopping: 0
                                };
                            }
                            
                            yearlyData[year].count++;
                            yearlyData[year].total += fp.total;
                            yearlyData[year].transport += fp.transport;
                            yearlyData[year].energy += fp.energy;
                            yearlyData[year].food += fp.food;
                            yearlyData[year].shopping += fp.shopping;
                        });
                        
                        // Calculate averages and format
                        return Object.values(yearlyData)
                            .map(year => ({
                                year: year.year,
                                avg_total: year.total / year.count,
                                avg_transport: year.transport / year.count,
                                avg_energy: year.energy / year.count,
                                avg_food: year.food / year.count,
                                avg_shopping: year.shopping / year.count
                            }))
                            .sort((a, b) => a.year.localeCompare(b.year));
                }
            },
            
            // Helper function to get week number
            getWeekNumber: function(date) {
                const d = new Date(date);
                d.setHours(0, 0, 0, 0);
                d.setDate(d.getDate() + 3 - (d.getDay() + 6) % 7);
                const week1 = new Date(d.getFullYear(), 0, 4);
                return 1 + Math.round(((d - week1) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);
            },
            
            // Set current user
            setCurrentUser: function(user) {
                localStorage.setItem('carbonEveCurrentUser', JSON.stringify(user));
            },
            
            // Get current user
            getCurrentUser: function() {
                const user = localStorage.getItem('carbonEveCurrentUser');
                return user ? JSON.parse(user) : null;
            },
            
            // Logout
            logout: function() {
                localStorage.removeItem('carbonEveCurrentUser');
            },
            
            // For debugging: Clear all data
            clearAllData: function() {
                localStorage.removeItem('carbonEveUsers');
                localStorage.removeItem('carbonEveFootprints');
                localStorage.removeItem('carbonEveCurrentUser');
            }
        };
    </script>
</body>
</html>